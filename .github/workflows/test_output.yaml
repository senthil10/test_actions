name: Test output
on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  test_output:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Try setting output
        id: updater
        run: echo "print_value=Content is same" >> $GITHUB_OUTPUT
      - name: Print the output
        run: echo "${{ steps.updater.outputs.print_value }}"
      - name: Dump github context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
      - name: Check out the repo
        uses: actions/checkout@v3
      - name: Test Git commands
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          FILE_TO_COMMIT: test_file.txt
          DESTINATION_BRANCH: develop
        run: |
          echo "This is a test file $(date)" >> $FILE_TO_COMMIT
          export TODAY=$( date -u '+%Y-%m-%d' )
          export MESSAGE="chore: Update EBI index - $TODAY"
          export SHA=$( git rev-parse $DESTINATION_BRANCH:$FILE_TO_COMMIT )
          export CONTENT=$( base64 -i $FILE_TO_COMMIT )
          gh api --method PUT /repos/:owner/:repo/contents/$FILE_TO_COMMIT \
            --field message="$MESSAGE" \
            --field content="$CONTENT" \
            --field encoding="base64" \
            --field branch="$DESTINATION_BRANCH" \
            --field sha="$SHA"

# git config --local user.name  github-actions        
# git config --local user.email "github-actions@users.noreply.github.com"
# git remote set-url origin https://github-actions:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
# git add test_file.txt
# git commit -m "Action file test" -s
# git push origin ${{ github.ref_name }}
